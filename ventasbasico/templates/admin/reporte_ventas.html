{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Reporte de Ventas{% endblock %}

{% block content %}
<div id="content-main">
    <h1>Reporte de Ventas</h1>
    
    <!-- Formulario de filtros -->
    <div class="module" style="margin-bottom: 20px;">
        <form method="get" style="padding: 20px;">
            <div style="display: flex; gap: 15px; align-items: flex-end;">
                <div>
                    <label for="fecha_inicio"><strong>Fecha Inicio:</strong></label><br>
                    <input type="date" id="fecha_inicio" name="fecha_inicio" 
                           value="{{ fecha_inicio }}" 
                           style="padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div>
                    <label for="fecha_fin"><strong>Fecha Fin:</strong></label><br>
                    <input type="date" id="fecha_fin" name="fecha_fin" 
                           value="{{ fecha_fin }}"
                           style="padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div>
                    <button type="submit" class="button" 
                            style="padding: 6px 15px; background-color: #417690; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Filtrar
                    </button>
                    <a href="{% url 'admin:reporte-ventas' %}" class="button" 
                       style="padding: 6px 15px; background-color: #666; color: white; text-decoration: none; border-radius: 4px; display: inline-block; margin-left: 5px;">
                        Limpiar
                    </a>
                </div>
            </div>
        </form>
    </div>

    <!-- Resumen estadístico -->
    <div class="module" style="margin-bottom: 20px;">
        <div style="padding: 20px; background-color: #f8f9fa;">
            <div style="display: flex; gap: 40px;">
                <div>
                    <h3 style="margin: 0 0 10px 0; color: #417690;">Total de Ventas</h3>
                    <p style="font-size: 24px; font-weight: bold; margin: 0;">${{ total_ventas|floatformat:2 }}</p>
                </div>
                <div>
                    <h3 style="margin: 0 0 10px 0; color: #417690;">Cantidad de Ventas</h3>
                    <p style="font-size: 24px; font-weight: bold; margin: 0;">{{ cantidad_ventas }}</p>
                </div>
                {% if cantidad_ventas > 0 %}
                <div>
                    <h3 style="margin: 0 0 10px 0; color: #417690;">Promedio por Venta</h3>
                    <p style="font-size: 24px; font-weight: bold; margin: 0;">
                        ${% widthratio total_ventas cantidad_ventas 1 %}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tabla de ventas -->
    <div class="module">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #417690; color: white;">
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Número</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Fecha</th>
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Cliente</th>
                    <th style="padding: 10px; text-align: right; border: 1px solid #ddd;">Total</th>
                    <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for venta in ventas %}
                <tr style="{% cycle 'background-color: #f9f9f9;' '' %}">
                    <td style="padding: 8px; border: 1px solid #ddd;">{{ venta.numero }}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">{{ venta.fecha|date:"d/m/Y" }}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">
                        {{ venta.rut_cliente.nombre }} {{ venta.rut_cliente.apellido }}
                        <br><small style="color: #666;">RUT: {{ venta.rut_cliente.rut }}</small>
                    </td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;">
                        ${{ venta.total|floatformat:2 }}
                    </td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                        <a href="{% url 'admin:ventasbasico_venta_change' venta.id %}" 
                           style="color: #417690; text-decoration: none;">
                            Ver Detalle
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="padding: 20px; text-align: center; color: #666;">
                        No hay ventas en el rango de fechas seleccionado
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div style="margin-top: 20px;">
        <a href="{% url 'admin:ventasbasico_venta_changelist' %}" class="button" 
           style="padding: 8px 15px; background-color: #666; color: white; text-decoration: none; border-radius: 4px; display: inline-block;">
            ← Volver a Ventas
        </a>
    </div>
</div>
{% endblock %}
